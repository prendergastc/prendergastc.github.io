<!DOCTYPE html>

<html lang="en">
    <head>
        <meta charset="utf-8"/>
        <meta content="IE=edge" http-equiv="X-UA-Compatible"/>
        <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
        <link href="./theme/css/elegant.prod.9e9d5ce754.css" media="screen" rel="stylesheet" type="text/css"/>
        <link href="./theme/css/custom.css" media="screen" rel="stylesheet" type="text/css"/>

        <link href="//fonts.googleapis.com" rel="dns-prefetch"/>
        <link crossorigin="" href="https://fonts.gstatic.com/" rel="preconnect"/>
        <link href="https://files.stork-search.net/basic.css" rel="stylesheet"/>
        <link href="https://cdn.datatables.net/2.3.2/css/dataTables.dataTables.css" rel="stylesheet"/>
        <link href="./theme/css/colorbox.css" rel="stylesheet"/>

        <meta content="Christopher Prendergast" name="author">

        <meta content="article" property="og:type">
        <meta content="summary" name="twitter:card"/>

<meta content="Jupyter, Python, GeoPandas, Notebooks, " name="keywords">

<meta content="Boundary Geometry Difference Query " property="og:title">
<meta content="./boundary_geometry_diff_query.html" property="og:url"/>
<meta content="Find differences in boundary geometry between different drop from IMA." property="og:description"/>
<meta content="portfolio" property="og:site_name"/>
<meta content="Christopher Prendergast" property="og:article:author"/>
<meta content="2025-07-06T00:00:00-07:00" property="og:article:published_time"/>
<meta content="2025-07-06T00:00:00-07:00" property="og:article:modified_time"/>
<meta content="Boundary Geometry Difference Query " name="twitter:title"/>
<meta content="Find differences in boundary geometry between different drop from IMA." name="twitter:description"/>

        <title>Boundary Geometry Difference Query  Â· portfolio
</title>



    </meta></meta></meta></meta></head>
    <body>
        <div id="content">
            <div class="navbar navbar-static-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-target=".nav-collapse" data-toggle="collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="./"><span class="site-name">portfolio</span></a>
                        <div class="nav-collapse collapse">
                            <ul class="nav pull-right top-menu">
                                <li>
                                    <a href=".">Home</a>
                                </li>
                                <li><a href="./pages/search.html">Search</a></li>
                                <li><a href="./categories.html">Categories</a></li>
                                <li><a href="./tags.html">Tags</a></li>
                                <li><a href="./archives.html">Archives</a></li>
                                <li><form action="./search.html" class="navbar-search" onsubmit="return validateForm(this.elements['q'].value);"> <input class="search-query" id="tipue_search_input" name="q" placeholder="Search" type="text"/></form></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span1"></div>
                    <div class="span10">
<article itemscope="">
<div class="row-fluid">
    <header class="page-header span10 offset2">
        <h1>
            <a href="./boundary_geometry_diff_query.html">
                Boundary Geometry Difference Query
            </a>
        </h1>
    </header>
</div>

<div class="row-fluid">
        <div class="span8 offset2 article-content">
            
            <main><div class="highlight"><pre><span></span><code>- Title: Boundary Geometry Difference Query
- Slug: boundary_geometry_diff_query
- Date: 07/06/2025
- Category: Notebooks
- Tags: Jupyter, Python, GeoPandas
- Author: Christopher Prendergast
- Summary: Find differences in boundary geometry between different drop from IMA.
</code></pre></div>
<p>conda create --name gp jupyter numpy pandas geopandas fiona shapely pyproj folium ipywidgetsconda activate gp</p>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">fiona</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">import</span> <span class="nn">shapely</span>
<span class="kn">import</span> <span class="nn">pyproj</span>
<span class="kn">import</span> <span class="nn">folium</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">jupyterlab</span>
<span class="kn">import</span> <span class="nn">ipywidgets</span> <span class="k">as</span> <span class="nn">widgets</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span>
<span class="kn">from</span> <span class="nn">shapely.geometry.polygon</span> <span class="kn">import</span> <span class="n">orient</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.basemap</span> <span class="kn">import</span> <span class="n">Basemap</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>


<span class="nb">print</span><span class="p">(</span><span class="s2">"Python version:"</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">version</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Version info:"</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Numpy:"</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Pandas:"</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"GeoPandas:"</span><span class="p">,</span> <span class="n">gpd</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Shapely:"</span><span class="p">,</span> <span class="n">shapely</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Folium:"</span><span class="p">,</span> <span class="n">folium</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Pyproj:"</span><span class="p">,</span> <span class="n">pyproj</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Matplotlib:"</span><span class="p">,</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Jupyterlab:"</span><span class="p">,</span> <span class="n">jupyterlab</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="nx">Python</span><span class="w"> </span><span class="nx">version</span><span class="p">:</span><span class="w"> </span><span class="m m-Double">3.13.5</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nx">packaged</span><span class="w"> </span><span class="nx">by</span><span class="w"> </span><span class="nx">Anaconda</span><span class="p">,</span><span class="w"> </span><span class="nx">Inc</span><span class="p">.</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">(</span><span class="nx">main</span><span class="p">,</span><span class="w"> </span><span class="nx">Jun</span><span class="w"> </span><span class="mi">12</span><span class="w"> </span><span class="mi">2025</span><span class="p">,</span><span class="w"> </span><span class="mi">11</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mi">21</span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nx">Clang</span><span class="w"> </span><span class="m m-Double">14.0.6</span><span class="w"> </span><span class="p">]</span>
<span class="nx">Version</span><span class="w"> </span><span class="nx">info</span><span class="p">:</span><span class="w"> </span><span class="nx">sys</span><span class="p">.</span><span class="nx">version_info</span><span class="p">(</span><span class="nx">major</span><span class="p">=</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="nx">minor</span><span class="p">=</span><span class="mi">13</span><span class="p">,</span><span class="w"> </span><span class="nx">micro</span><span class="p">=</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="nx">releaselevel</span><span class="p">=</span><span class="err">'</span><span class="k">final</span><span class="err">'</span><span class="p">,</span><span class="w"> </span><span class="nx">serial</span><span class="p">=</span><span class="mi">0</span><span class="p">)</span>
<span class="nx">Numpy</span><span class="p">:</span><span class="w"> </span><span class="m m-Double">2.3.1</span>
<span class="nx">Pandas</span><span class="p">:</span><span class="w"> </span><span class="m m-Double">2.2.3</span>
<span class="nx">GeoPandas</span><span class="p">:</span><span class="w"> </span><span class="m m-Double">1.0.1</span>
<span class="nx">Shapely</span><span class="p">:</span><span class="w"> </span><span class="m m-Double">2.0.6</span>
<span class="nx">Folium</span><span class="p">:</span><span class="w"> </span><span class="m m-Double">0.14.0</span>
<span class="nx">Pyproj</span><span class="p">:</span><span class="w"> </span><span class="m m-Double">3.6.1</span>
<span class="nx">Matplotlib</span><span class="p">:</span><span class="w"> </span><span class="m m-Double">3.10.0</span>
<span class="nx">Jupyterlab</span><span class="p">:</span><span class="w"> </span><span class="m m-Double">4.3.4</span>
</code></pre></div>
<p>Python version: 3.13.5 | packaged by Anaconda, Inc. | (main, Jun 12 2025, 11:09:21) [Clang 14.0.6 ]
Version info: sys.version_info(major=3, minor=13, micro=5, releaselevel='final', serial=0)
Numpy: 2.3.1
Pandas: 2.2.3
GeoPandas: 1.0.1
Shapely: 2.0.6
Folium: 0.14.0
Pyproj: 3.6.1
Matplotlib: 3.10.0
Jupyterlab: 4.3.4</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Constants</span>
<span class="n">ROOT_PATH</span> <span class="o">=</span> <span class="s2">"/Users/christopher_prendergast/Documents/MDH/IMA_20250625_difference_query"</span>
<span class="n">SEARCH_PATTERN</span> <span class="o">=</span> <span class="s2">"</span><span class="se">\\</span><span class="s2">.gdb$"</span>

<span class="c1"># Note: F1 is old file, F2 is new file.</span>

<span class="c1"># F1 = "20241203_SovereignLimitsDB_Q4_2024_Apple/GIS/SovereignLimitsDB_Q4_2024.gdb"</span>
<span class="c1"># F2 = "20250408_SovereignLimitsDB_Q1_2025_Apple/GIS/SovereignLimitsDB_Q1_2025.gdb"</span>

<span class="n">F1</span> <span class="o">=</span> <span class="s2">"20241002_SovereignLimitsDB_Q3_2024_Apple/GIS/SovereignLimitsDB_Q3_2024.gdb"</span>
<span class="n">F2</span> <span class="o">=</span> <span class="s2">"20241203_SovereignLimitsDB_Q4_2024_Apple/GIS/SovereignLimitsDB_Q4_2024.gdb"</span>

<span class="c1"># Using "state" as key</span>
<span class="c1"># LAYERS = ["Sovereignty_Areas"]</span>
<span class="c1"># DISSOLVE_BY = "state"</span>
<span class="c1"># DISSOLVED_COLUMNS = ["state", "iso_a3", "geometry"]</span>
<span class="c1"># OUTPUT_COLUMNS = ["state", "iso_a3_f1", "lat", "lon", "sdiff_area", "sdiff_perimeter", "iq"]</span>
<span class="c1"># GEOMETRY_COLUMNS = ["sdiff", "geometry_f1", "geometry_f2"]</span>

<span class="c1"># Using "UID" as key. Note: all columns are renamed to be lowercase.</span>
<span class="n">LAYERS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"Sovereignty_Areas"</span><span class="p">]</span>
<span class="n">DISSOLVE_BY</span> <span class="o">=</span> <span class="s2">"uid"</span>
<span class="n">DISSOLVED_COLUMNS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"uid"</span><span class="p">,</span> <span class="s2">"state"</span><span class="p">,</span> <span class="s2">"iso_a3"</span><span class="p">,</span> <span class="s2">"geometry"</span><span class="p">]</span>
<span class="n">OUTPUT_COLUMNS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"state_f1"</span><span class="p">,</span> <span class="s2">"state_f2"</span><span class="p">,</span> <span class="s2">"iso_a3_f1"</span><span class="p">,</span> <span class="s2">"lat"</span><span class="p">,</span> <span class="s2">"lon"</span><span class="p">,</span> <span class="s2">"sdiff_area"</span><span class="p">,</span> <span class="s2">"sdiff_perimeter"</span><span class="p">,</span> <span class="s2">"iq"</span><span class="p">]</span>  <span class="c1"># NB: OUTPUT_COLUMNS should not include DISSOLVE_BY keys since they will be the index.</span>
<span class="n">GEOMETRY_COLUMNS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"sdiff"</span><span class="p">,</span> <span class="s2">"geometry_f1"</span><span class="p">,</span> <span class="s2">"geometry_f2"</span><span class="p">]</span>

<span class="c1"># LAYERS = ["Shared_Sovereignty_Areas"]</span>
<span class="c1"># DISSOLVE_BY = ["state1", "state2", "state3"]</span>
<span class="c1"># DISSOLVED_COLUMNS = ["state1", "state2", "state3", "geometry"]</span>
<span class="c1"># OUTPUT_COLUMNS = ["state1", "state2", "state3", "lat", "lon", "sdiff_area", "sdiff_perimeter"]</span>
<span class="c1"># GEOMETRY_COLUMNS = ["sdiff", "geometry_f1", "geometry_f2"]</span>

<span class="c1"># Filter results with following parameters.</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">MIN_AREA_THRESHOLD</span> <span class="o">=</span> <span class="mi">25</span>
<span class="n">MIN_IQ_THRESHOLD</span> <span class="o">=</span> <span class="mf">0.03</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_dir_size</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">"."</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Get total size of all files within a directory.</span>

<span class="sd">    Args:</span>
<span class="sd">        path (str): The path to start from.</span>

<span class="sd">    Returns:</span>
<span class="sd">        int: The total size in bytes.</span>

<span class="sd">    """</span>
    <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">with</span> <span class="n">os</span><span class="o">.</span><span class="n">scandir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="k">as</span> <span class="n">it</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">it</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
                <span class="n">total</span> <span class="o">+=</span> <span class="n">entry</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_size</span>
            <span class="k">elif</span> <span class="n">entry</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
                <span class="n">total</span> <span class="o">+=</span> <span class="n">get_dir_size</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">total</span>


<span class="k">def</span> <span class="nf">get_size</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">"."</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Gets the size of a file. If file is a directory get the total of all files </span>
<span class="sd">    under the directory.</span>

<span class="sd">    Args:</span>
<span class="sd">        path (str): The path to start from.</span>

<span class="sd">    Returns:</span>
<span class="sd">        int: The total size in bytes.</span>

<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">get_dir_size</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">get_humanbytes</span><span class="p">(</span><span class="n">B</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Return the given bytes as a human friendly KB, MB, GB, or TB string.</span>

<span class="sd">    Args:</span>
<span class="sd">        B (int/float): The size in bytes.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The size in human friendly form.</span>

<span class="sd">    """</span>
    <span class="n">B</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>
    <span class="n">KB</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
    <span class="n">MB</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">KB</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="c1"># 1,048,576</span>
    <span class="n">GB</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">KB</span> <span class="o">**</span> <span class="mi">3</span><span class="p">)</span> <span class="c1"># 1,073,741,824</span>
    <span class="n">TB</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">KB</span> <span class="o">**</span> <span class="mi">4</span><span class="p">)</span> <span class="c1"># 1,099,511,627,776</span>

    <span class="k">if</span> <span class="n">B</span> <span class="o">&lt;</span> <span class="n">KB</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">'</span><span class="si">{0}</span><span class="s1"> </span><span class="si">{1}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="s1">'Bytes'</span> <span class="k">if</span> <span class="mi">0</span> <span class="o">==</span> <span class="n">B</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="s1">'Byte'</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">KB</span> <span class="o">&lt;=</span> <span class="n">B</span> <span class="o">&lt;</span> <span class="n">MB</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">'</span><span class="si">{0:.2f}</span><span class="s1"> KB'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">B</span> <span class="o">/</span> <span class="n">KB</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">MB</span> <span class="o">&lt;=</span> <span class="n">B</span> <span class="o">&lt;</span> <span class="n">GB</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">'</span><span class="si">{0:.2f}</span><span class="s1"> MB'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">B</span> <span class="o">/</span> <span class="n">MB</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">GB</span> <span class="o">&lt;=</span> <span class="n">B</span> <span class="o">&lt;</span> <span class="n">TB</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">'</span><span class="si">{0:.2f}</span><span class="s1"> GB'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">B</span> <span class="o">/</span> <span class="n">GB</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">TB</span> <span class="o">&lt;=</span> <span class="n">B</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">'</span><span class="si">{0:.2f}</span><span class="s1"> TB'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">B</span> <span class="o">/</span> <span class="n">TB</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">find_by_pattern</span><span class="p">(</span><span class="n">root_dir</span><span class="p">,</span> <span class="n">pattern</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Walks a directory tree, finds files matching a pattern, and returns their</span>
<span class="sd">    paths, file type, and sizes.</span>

<span class="sd">    Args:</span>
<span class="sd">        root_dir (str): The starting directory for the traversal.</span>
<span class="sd">        pattern (str): The regular expression pattern to match in </span>
<span class="sd">                       directory and filenames </span>
<span class="sd">                       (e.g., "gbb$", ".*SovereignLimitsDB_Q4_2024_Apple.*\\.gdb$").</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: A list of tuples, where each tuple contains (file_type, </span>
<span class="sd">              name, file_path, file_size_in_bytes).</span>

<span class="sd">    """</span>
    <span class="n">matching_files_info</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">dirpath</span><span class="p">,</span> <span class="n">dirnames</span><span class="p">,</span> <span class="n">filenames</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="n">root_dir</span><span class="p">):</span>

        <span class="c1"># Note: including directories here because geodatabase files are actually directories.</span>
        <span class="k">for</span> <span class="n">dirname</span> <span class="ow">in</span> <span class="n">dirnames</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">dirname</span><span class="p">):</span>
                <span class="n">dir_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">dirname</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">dir_size</span> <span class="o">=</span> <span class="n">get_dir_size</span><span class="p">(</span><span class="n">dir_path</span><span class="p">)</span>
                    <span class="n">matching_files_info</span><span class="o">.</span><span class="n">append</span><span class="p">((</span> <span class="s2">"directory"</span><span class="p">,</span> <span class="n">dirname</span><span class="p">,</span> <span class="n">dir_path</span><span class="p">,</span> <span class="n">dir_size</span><span class="p">))</span>
                <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Error accessing directory </span><span class="si">{</span><span class="n">dir_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">filenames</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
                <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirpath</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
                        <span class="n">file_size</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
                        <span class="n">matching_files_info</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">"file"</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">file_path</span><span class="p">,</span> <span class="n">file_size</span><span class="p">))</span>
                <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Error accessing file </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">matching_files_info</span>


<span class="k">def</span> <span class="nf">get_gdb_layer_info</span><span class="p">(</span><span class="n">gdb_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Lists the layers in a Geodatabase file with their geometry types </span>
<span class="sd">    and feature counts.</span>

<span class="sd">    Args:</span>
<span class="sd">        gdb_path (str): The path to the File Geodatabase (.gdb).</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: A list of dictionaries of values where the keys </span>
<span class="sd">              are 'layer_name', 'geometry_type', 'feature_count', </span>
<span class="sd">              'gdb_path' and 'columns'.</span>

<span class="sd">    """</span>
    <span class="n">layer_lst</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">layers</span> <span class="o">=</span> <span class="n">fiona</span><span class="o">.</span><span class="n">listlayers</span><span class="p">(</span><span class="n">gdb_path</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">layer_name</span> <span class="ow">in</span> <span class="n">layers</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Read the layer into a GeoDataFrame</span>
                <span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">gdb_path</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="n">layer_name</span><span class="p">)</span>

                <span class="c1"># Get geometry type</span>
                <span class="c1"># Check for non-empty geometry column to determine type</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">gdf</span><span class="o">.</span><span class="n">empty</span> <span class="ow">and</span> <span class="n">gdf</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">notna</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
                    <span class="n">geometry_type</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">geom_type</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">geometry_type</span> <span class="o">=</span> <span class="s2">"No Geometry"</span>

                <span class="c1"># Get feature count</span>
                <span class="n">feature_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">gdf</span><span class="p">)</span>

                <span class="c1"># Get list of columns</span>
                <span class="n">columns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">gdf</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

                <span class="n">layer_info</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">"layer_name"</span><span class="p">:</span> <span class="n">layer_name</span><span class="p">,</span>
                    <span class="s2">"geometry_type"</span><span class="p">:</span> <span class="n">geometry_type</span><span class="p">,</span>
                    <span class="s2">"feature_count"</span><span class="p">:</span> <span class="n">feature_count</span><span class="p">,</span>
                    <span class="s2">"gdb_path"</span><span class="p">:</span> <span class="n">gdb_path</span><span class="p">,</span>
                    <span class="s2">"columns"</span><span class="p">:</span> <span class="n">columns</span>
                <span class="p">}</span>
                <span class="n">layer_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">layer_info</span><span class="p">)</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Error processing layer '</span><span class="si">{</span><span class="n">layer_name</span><span class="si">}</span><span class="s2">': </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Error accessing GDB at '</span><span class="si">{</span><span class="n">gdb_path</span><span class="si">}</span><span class="s2">': </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">layer_lst</span>


<span class="k">def</span> <span class="nf">get_area_perim</span><span class="p">(</span><span class="n">gdf</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Gets the area and perimeter for each polygon in a GeoDataFrame with geometry in </span>
<span class="sd">    geographic coordinates (lat/lon).</span>

<span class="sd">    Inspired by: </span>
<span class="sd">    https://gis.stackexchange.com/questions/413349/calculating-area-of-lat-lon-polygons-without-transformation-using-geopandas</span>

<span class="sd">    Args:</span>
<span class="sd">        gdf (GeoDataFrame): The GeoDataFrame.</span>

<span class="sd">    Returns:</span>
<span class="sd">        GeoSeries: A GeoSeries of tuples, where each tuple contains (area, perimeter).</span>

<span class="sd">    """</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">gdf</span><span class="o">.</span><span class="n">crs</span> <span class="ow">and</span> <span class="n">gdf</span><span class="o">.</span><span class="n">crs</span><span class="o">.</span><span class="n">is_geographic</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">'GeoDataFrame should have geographic coordinate system'</span><span class="p">)</span>

    <span class="n">geod</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">crs</span><span class="o">.</span><span class="n">get_geod</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">calculate</span><span class="p">(</span><span class="n">geom</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">geom</span><span class="o">.</span><span class="n">geom_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'MultiPolygon'</span><span class="p">,</span> <span class="s1">'Polygon'</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

        <span class="c1"># For MultiPolygon do each separately.</span>
        <span class="k">if</span> <span class="n">geom</span><span class="o">.</span><span class="n">geom_type</span><span class="o">==</span><span class="s1">'MultiPolygon'</span><span class="p">:</span>

            <span class="n">res</span> <span class="o">=</span> <span class="p">[</span><span class="n">calc</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">geom</span><span class="o">.</span><span class="n">geoms</span><span class="p">]</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">res</span><span class="p">])</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">p</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">res</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">a</span><span class="p">,</span> <span class="n">p</span>

        <span class="c1"># Orient to ensure a counter-clockwise traversal. </span>
        <span class="c1"># See https://pyproj4.github.io/pyproj/stable/api/geod.html</span>
        <span class="k">return</span> <span class="n">geod</span><span class="o">.</span><span class="n">geometry_area_perimeter</span><span class="p">(</span><span class="n">orient</span><span class="p">(</span><span class="n">geom</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">gdf</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">calculate</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">calculate_iq</span><span class="p">(</span><span class="n">area</span><span class="p">,</span> <span class="n">perimeter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Calculate the isoperimetric quotient for a polygon. This is useful to </span>
<span class="sd">    detect and remove slivers.</span>
<span class="sd">    Inspired by: </span>
<span class="sd">    https://gis.stackexchange.com/questions/442050/removing-detecting-polygons-that-are-infinitely-thin-and-look-like-lines</span>

<span class="sd">    Args:</span>
<span class="sd">        area (float): The area of the polygon.</span>
<span class="sd">        perimter(float): The perimeter of the polygon.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: The isoperimetric quotient.    </span>

<span class="sd">    """</span>
    <span class="k">return</span> <span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">area</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">perimeter</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">standardize_col</span><span class="p">(</span><span class="n">old_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Standardize column name by converting to lower case.</span>

<span class="sd">    Args:</span>
<span class="sd">        old_name (str): The old column name.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The new column name.</span>

<span class="sd">    """</span>
    <span class="n">new_name</span> <span class="o">=</span> <span class="n">old_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">new_name</span>


<span class="k">def</span> <span class="nf">display_full</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Display a DataFrame with certain options to show more data.</span>

<span class="sd">    Args:</span>
<span class="sd">        df (DataFrme): The DataFrame object to display.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    """</span>
    <span class="k">with</span> <span class="n">pd</span><span class="o">.</span><span class="n">option_context</span><span class="p">(</span><span class="s1">'display.max_rows'</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                           <span class="s1">'display.max_columns'</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span>
                           <span class="s1">'display.width'</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span>
                           <span class="s1">'display.float_format'</span><span class="p">,</span> <span class="s1">'</span><span class="si">{:20,.2f}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">,</span>
                           <span class="s1">'display.max_colwidth'</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">find_file_input</span><span class="p">():</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Widget interface to gather path and search pattern from user input.</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                 <span class="n">root_path</span> <span class="o">=</span> <span class="n">ROOT_PATH</span><span class="p">,</span> 
                 <span class="n">search_pattern</span> <span class="o">=</span> <span class="n">SEARCH_PATTERN</span>
                <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root_path</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">'Root path: '</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">root_path</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">search_pattern</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">'Search pattern: '</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">search_pattern</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">continuous_update</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">display</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_pattern</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">observe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">value</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span>


<span class="k">class</span> <span class="nc">select_file_input</span><span class="p">():</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Widget interface to select the two files to coparefrom user input.</span>
<span class="sd">    TODO: this should be a drop down pulling names and values from dataframe.</span>
<span class="sd">    """</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
                 <span class="n">f1</span> <span class="o">=</span> <span class="n">F1</span><span class="p">,</span> 
                 <span class="n">f2</span> <span class="o">=</span> <span class="n">F2</span>
                <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f1</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">'File #1: '</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">f1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f2</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">Text</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s1">'File #2: '</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">f2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">continuous_update</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">display</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">f2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">observe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">value</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span>
</code></pre></div>
<h1 id="find-files">Find files</h1>
<div class="highlight"><pre><span></span><code><span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Enter the root path and the search pattern (regular expression),"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"then press return in any field:"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>
<span class="n">find_files</span> <span class="o">=</span> <span class="n">find_file_input</span><span class="p">()</span>
<span class="nb">print</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">Enter</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">search</span><span class="w"> </span><span class="n">pattern</span><span class="w"> </span><span class="p">(</span><span class="n">regular</span><span class="w"> </span><span class="n">expression</span><span class="p">),</span>
<span class="n">then</span><span class="w"> </span><span class="n">press</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">in</span><span class="w"> </span><span class="n">any</span><span class="w"> </span><span class="nl">field:</span>




<span class="n">Text</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="p">'</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">christopher_prendergast</span><span class="o">/</span><span class="n">Documents</span><span class="o">/</span><span class="n">MDH</span><span class="o">/</span><span class="n">IMA_20250625_difference_query</span><span class="p">',</span><span class="w"> </span><span class="n">description</span><span class="o">=</span><span class="p">'</span><span class="n">Root</span><span class="w"> </span><span class="n">pat</span><span class="err">â¦</span>



<span class="n">Text</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="p">'</span><span class="n">\\.gdb$',</span><span class="w"> </span><span class="n">description</span><span class="o">=</span><span class="p">'</span><span class="n">Search</span><span class="w"> </span><span class="nl">pattern:</span><span class="w"> </span><span class="p">')</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">root_path</span> <span class="o">=</span> <span class="n">find_files</span><span class="o">.</span><span class="n">root_path</span><span class="o">.</span><span class="n">value</span>
<span class="n">search_pattern</span> <span class="o">=</span> <span class="n">find_files</span><span class="o">.</span><span class="n">search_pattern</span><span class="o">.</span><span class="n">value</span>

<span class="n">found_files</span> <span class="o">=</span> <span class="n">find_by_pattern</span><span class="p">(</span><span class="n">root_path</span><span class="p">,</span> <span class="n">search_pattern</span><span class="p">)</span>

<span class="k">if</span> <span class="n">found_files</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Files matching '</span><span class="si">{</span><span class="n">search_pattern</span><span class="si">}</span><span class="s2">' in '</span><span class="si">{</span><span class="n">root_path</span><span class="si">}</span><span class="s2">' and its subdirectories:"</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">found_files</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">"file_type"</span><span class="p">,</span> <span class="s2">"name"</span><span class="p">,</span> <span class="s2">"full_path"</span><span class="p">,</span> <span class="s2">"size"</span><span class="p">])</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">"size"</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">"size"</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">get_humanbytes</span><span class="p">)</span>
    <span class="n">display_full</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">fn</span> <span class="o">=</span> <span class="s2">"files.csv"</span>  <span class="c1"># TODO: put this in the correct subdirectory.</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"...Saving file:"</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"No files matching '</span><span class="si">{</span><span class="n">search_pattern</span><span class="si">}</span><span class="s2">' found in '</span><span class="si">{</span><span class="n">root_path</span><span class="si">}</span><span class="s2">' and its subdirectories."</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>Files matching '\.gdb$' in '/Users/christopher_prendergast/Documents/MDH/IMA_20250625_difference_query' and its subdirectories:
</code></pre></div>
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe my-data-table">
<thead>
<tr style="text-align: right;">
<th></th>
<th>file_type</th>
<th>name</th>
<th>full_path</th>
<th>size</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>directory</td>
<td>SovereignLimitsDB_Q3_2024_DENSIFIED.gdb</td>
<td>/Users/christopher_prendergast/Documents/MDH/IMA_20250625_difference_query/20241002_SovereignLimitsDB_Q3_2024_Apple/GIS/SovereignLimitsDB_Q3_2024_DENSIFIED.gdb</td>
<td>585.46 MB</td>
</tr>
<tr>
<th>1</th>
<td>directory</td>
<td>SovereignLimitsDB_Q3_2024.gdb</td>
<td>/Users/christopher_prendergast/Documents/MDH/IMA_20250625_difference_query/20241002_SovereignLimitsDB_Q3_2024_Apple/GIS/SovereignLimitsDB_Q3_2024.gdb</td>
<td>581.27 MB</td>
</tr>
<tr>
<th>2</th>
<td>directory</td>
<td>SovereignLimitsDB_Q1_2025.gdb</td>
<td>/Users/christopher_prendergast/Documents/MDH/IMA_20250625_difference_query/20250408_SovereignLimitsDB_Q1_2025_Apple/GIS/SovereignLimitsDB_Q1_2025.gdb</td>
<td>801.40 MB</td>
</tr>
<tr>
<th>3</th>
<td>directory</td>
<td>SovereignLimitsDB_Q1_2025_DENSIFIED.gdb</td>
<td>/Users/christopher_prendergast/Documents/MDH/IMA_20250625_difference_query/20250408_SovereignLimitsDB_Q1_2025_Apple/GIS/SovereignLimitsDB_Q1_2025_DENSIFIED.gdb</td>
<td>948.66 MB</td>
</tr>
<tr>
<th>4</th>
<td>directory</td>
<td>SovereignLimitsDB_Q4_2024.gdb</td>
<td>/Users/christopher_prendergast/Documents/MDH/IMA_20250625_difference_query/20241203_SovereignLimitsDB_Q4_2024_Apple/GIS/SovereignLimitsDB_Q4_2024.gdb</td>
<td>551.10 MB</td>
</tr>
<tr>
<th>5</th>
<td>directory</td>
<td>SovereignLimitsDB_Q4_2024_DENSIFIED.gdb</td>
<td>/Users/christopher_prendergast/Documents/MDH/IMA_20250625_difference_query/20241203_SovereignLimitsDB_Q4_2024_Apple/GIS/SovereignLimitsDB_Q4_2024_DENSIFIED.gdb</td>
<td>674.17 MB</td>
</tr>
</tbody>
</table>
</div>
<div class="highlight"><pre><span></span><code>...Saving file: files.csv
</code></pre></div>
<h1 id="specify-which-files-to-compare">Specify which files to compare</h1>
<div class="highlight"><pre><span></span><code><span class="nb">print</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Enter the paths of the 2 files to compare,"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"then press return in any field:"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">()</span>
<span class="n">select_files</span> <span class="o">=</span> <span class="n">select_file_input</span><span class="p">()</span>
<span class="nb">print</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>Enter the paths of the 2 files to compare,
then press return in any field:




Text(value='20241002_SovereignLimitsDB_Q3_2024_Apple/GIS/SovereignLimitsDB_Q3_2024.gdb', description='File #1:â¦



Text(value='20241203_SovereignLimitsDB_Q4_2024_Apple/GIS/SovereignLimitsDB_Q4_2024.gdb', description='File #2:â¦
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="n">f1</span> <span class="o">=</span> <span class="n">select_files</span><span class="o">.</span><span class="n">f1</span><span class="o">.</span><span class="n">value</span>
<span class="n">f2</span> <span class="o">=</span> <span class="n">select_files</span><span class="o">.</span><span class="n">f2</span><span class="o">.</span><span class="n">value</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"...f1: </span><span class="si">{</span><span class="n">f1</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">get_humanbytes</span><span class="p">(</span><span class="n">get_size</span><span class="p">(</span><span class="n">f1</span><span class="p">))</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"...f2: </span><span class="si">{</span><span class="n">f2</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">get_humanbytes</span><span class="p">(</span><span class="n">get_size</span><span class="p">(</span><span class="n">f2</span><span class="p">))</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="n">files</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"f1"</span><span class="p">:</span> <span class="n">f1</span><span class="p">,</span> <span class="s2">"f2"</span><span class="p">:</span> <span class="n">f2</span><span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>...f1: 20241002_SovereignLimitsDB_Q3_2024_Apple/GIS/SovereignLimitsDB_Q3_2024.gdb, 581.27 MB
...f2: 20241203_SovereignLimitsDB_Q4_2024_Apple/GIS/SovereignLimitsDB_Q4_2024.gdb, 551.10 MB
</code></pre></div>
<h1 id="list-individual-layers-inside-selected-files">List individual layers inside selected files</h1>
<div class="highlight"><pre><span></span><code><span class="n">info_lst</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">files</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">info_lst</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">get_gdb_layer_info</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>

<span class="n">info_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">info_lst</span><span class="p">)</span>
<span class="n">info_df</span> <span class="o">=</span> <span class="n">info_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s2">"layer_name"</span><span class="p">,</span> <span class="s2">"gdb_path"</span><span class="p">])</span>
<span class="n">display</span><span class="p">(</span><span class="n">info_df</span><span class="p">)</span>
<span class="n">fn</span> <span class="o">=</span> <span class="s2">"info.csv"</span>  <span class="c1"># TODO: put this in the correct subdirectory.</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"...Saving file:"</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
<span class="n">info_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe my-data-table">
<thead>
<tr style="text-align: right;">
<th></th>
<th>layer_name</th>
<th>geometry_type</th>
<th>feature_count</th>
<th>gdb_path</th>
<th>columns</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>Archipelagic_Baselines</td>
<td>MultiLineString</td>
<td>29</td>
<td>20241002_SovereignLimitsDB_Q3_2024_Apple/GIS/S...</td>
<td>[IMPEC, UID, Notes, State, Region, portalURL, ...</td>
</tr>
<tr>
<th>24</th>
<td>Archipelagic_Baselines</td>
<td>MultiLineString</td>
<td>29</td>
<td>20241203_SovereignLimitsDB_Q4_2024_Apple/GIS/S...</td>
<td>[IMPEC, UID, Notes, State, Region, portalURL, ...</td>
</tr>
<tr>
<th>20</th>
<td>COMBINED_Disputed_Sovereignty_Areas_Disputed_E...</td>
<td>MultiPolygon</td>
<td>160</td>
<td>20241002_SovereignLimitsDB_Q3_2024_Apple/GIS/S...</td>
<td>[IMPEC, disputeName, State_1, PE0_1, ISO_A3_1,...</td>
</tr>
<tr>
<th>45</th>
<td>COMBINED_Disputed_Sovereignty_Areas_Disputed_E...</td>
<td>MultiPolygon</td>
<td>159</td>
<td>20241203_SovereignLimitsDB_Q4_2024_Apple/GIS/S...</td>
<td>[IMPEC, disputeName, State_1, PE0_1, ISO_A3_1,...</td>
</tr>
<tr>
<th>21</th>
<td>COMBINED_Sovereignty_Areas_Exclusive_Economic_...</td>
<td>MultiPolygon</td>
<td>277</td>
<td>20241002_SovereignLimitsDB_Q3_2024_Apple/GIS/S...</td>
<td>[IMPEC, State, ISO_A3, ISO_A2, Shape_Length, S...</td>
</tr>
<tr>
<th>23</th>
<td>COMBINED_Sovereignty_Areas_Exclusive_Economic_...</td>
<td>MultiPolygon</td>
<td>280</td>
<td>20241203_SovereignLimitsDB_Q4_2024_Apple/GIS/S...</td>
<td>[IMPEC, State, ISO_A3, ISO_A2, Shape_Length, S...</td>
</tr>
<tr>
<th>1</th>
<td>Disputed_Contentious_Sovereignty</td>
<td>Point</td>
<td>249</td>
<td>20241002_SovereignLimitsDB_Q3_2024_Apple/GIS/S...</td>
<td>[UID, Type, IMPEC, PE0_1, PE0_2, Notes, Summar...</td>
</tr>
<tr>
<th>25</th>
<td>Disputed_Contentious_Sovereignty</td>
<td>Point</td>
<td>249</td>
<td>20241203_SovereignLimitsDB_Q4_2024_Apple/GIS/S...</td>
<td>[UID, Type, IMPEC, PE0_1, PE0_2, Notes, Summar...</td>
</tr>
<tr>
<th>15</th>
<td>Disputed_Exclusive_Economic_Zones</td>
<td>MultiPolygon</td>
<td>38</td>
<td>20241002_SovereignLimitsDB_Q3_2024_Apple/GIS/S...</td>
<td>[UID, IMPEC, disputeName, Notes, State_1, PE0_...</td>
</tr>
<tr>
<th>42</th>
<td>Disputed_Exclusive_Economic_Zones</td>
<td>MultiPolygon</td>
<td>38</td>
<td>20241203_SovereignLimitsDB_Q4_2024_Apple/GIS/S...</td>
<td>[UID, IMPEC, disputeName, Notes, State_1, PE0_...</td>
</tr>
<tr>
<th>16</th>
<td>Disputed_Sovereignty_Areas</td>
<td>MultiPolygon</td>
<td>198</td>
<td>20241002_SovereignLimitsDB_Q3_2024_Apple/GIS/S...</td>
<td>[UID, IMPEC, disputeName, Notes, DF_Control, S...</td>
</tr>
<tr>
<th>41</th>
<td>Disputed_Sovereignty_Areas</td>
<td>MultiPolygon</td>
<td>198</td>
<td>20241203_SovereignLimitsDB_Q4_2024_Apple/GIS/S...</td>
<td>[UID, IMPEC, disputeName, Notes, DF_Control, S...</td>
</tr>
<tr>
<th>17</th>
<td>Disputed_Sovereignty_Areas_with_Administrative...</td>
<td>MultiPolygon</td>
<td>218</td>
<td>20241002_SovereignLimitsDB_Q3_2024_Apple/GIS/S...</td>
<td>[UID, IMPEC, disputeName, Notes, DF_Control, S...</td>
</tr>
<tr>
<th>40</th>
<td>Disputed_Sovereignty_Areas_with_Administrative...</td>
<td>MultiPolygon</td>
<td>218</td>
<td>20241203_SovereignLimitsDB_Q4_2024_Apple/GIS/S...</td>
<td>[UID, IMPEC, disputeName, Notes, DF_Control, S...</td>
</tr>
<tr>
<th>2</th>
<td>EEZ_Limits</td>
<td>MultiLineString</td>
<td>173</td>
<td>20241002_SovereignLimitsDB_Q3_2024_Apple/GIS/S...</td>
<td>[UID, IMPEC, Notes, Region, State, portalURL, ...</td>
</tr>
<tr>
<th>26</th>
<td>EEZ_Limits</td>
<td>MultiLineString</td>
<td>173</td>
<td>20241203_SovereignLimitsDB_Q4_2024_Apple/GIS/S...</td>
<td>[UID, IMPEC, Notes, Region, State, portalURL, ...</td>
</tr>
<tr>
<th>18</th>
<td>Exclusive_Economic_Zones</td>
<td>MultiPolygon</td>
<td>216</td>
<td>20241002_SovereignLimitsDB_Q3_2024_Apple/GIS/S...</td>
<td>[UID, IMPEC, State, ISO_A3, ISO_A2, Notes, Sha...</td>
</tr>
<tr>
<th>43</th>
<td>Exclusive_Economic_Zones</td>
<td>MultiPolygon</td>
<td>277</td>
<td>20241203_SovereignLimitsDB_Q4_2024_Apple/GIS/S...</td>
<td>[UID, IMPEC, State, ISO_A3, ISO_A2, Notes, Sha...</td>
</tr>
<tr>
<th>3</th>
<td>Extended_Continental_Shelf_Submissions</td>
<td>MultiLineString</td>
<td>172</td>
<td>20241002_SovereignLimitsDB_Q3_2024_Apple/GIS/S...</td>
<td>[UID, IMPEC1, IMPEC2, IMPEC3, IMPEC4, IMPEC5, ...</td>
</tr>
<tr>
<th>27</th>
<td>Extended_Continental_Shelf_Submissions</td>
<td>MultiLineString</td>
<td>172</td>
<td>20241203_SovereignLimitsDB_Q4_2024_Apple/GIS/S...</td>
<td>[UID, IMPEC1, IMPEC2, IMPEC3, IMPEC4, IMPEC5, ...</td>
</tr>
<tr>
<th>4</th>
<td>Extended_Continental_Shelf_Submissions_Polygons</td>
<td>MultiPolygon</td>
<td>151</td>
<td>20241002_SovereignLimitsDB_Q3_2024_Apple/GIS/S...</td>
<td>[UID, IMPEC1, IMPEC2, IMPEC3, IMPEC4, IMPEC5, ...</td>
</tr>
<tr>
<th>28</th>
<td>Extended_Continental_Shelf_Submissions_Polygons</td>
<td>MultiPolygon</td>
<td>151</td>
<td>20241203_SovereignLimitsDB_Q4_2024_Apple/GIS/S...</td>
<td>[UID, IMPEC1, IMPEC2, IMPEC3, IMPEC4, IMPEC5, ...</td>
</tr>
<tr>
<th>5</th>
<td>Implied_Land_Limits</td>
<td>MultiLineString</td>
<td>11</td>
<td>20241002_SovereignLimitsDB_Q3_2024_Apple/GIS/S...</td>
<td>[IMPEC1, IMPEC2, UID, Notes, State1, State2, L...</td>
</tr>
<tr>
<th>29</th>
<td>Implied_Land_Limits</td>
<td>MultiLineString</td>
<td>9</td>
<td>20241203_SovereignLimitsDB_Q4_2024_Apple/GIS/S...</td>
<td>[IMPEC1, IMPEC2, UID, Notes, State1, State2, L...</td>
</tr>
<tr>
<th>6</th>
<td>Implied_Maritime_Limits</td>
<td>MultiLineString</td>
<td>143</td>
<td>20241002_SovereignLimitsDB_Q3_2024_Apple/GIS/S...</td>
<td>[IMPEC1, IMPEC2, UID, State1, State2, Label, R...</td>
</tr>
<tr>
<th>30</th>
<td>Implied_Maritime_Limits</td>
<td>MultiLineString</td>
<td>143</td>
<td>20241203_SovereignLimitsDB_Q4_2024_Apple/GIS/S...</td>
<td>[IMPEC1, IMPEC2, UID, State1, State2, Label, R...</td>
</tr>
<tr>
<th>7</th>
<td>Land_Boundaries</td>
<td>MultiLineString</td>
<td>9879</td>
<td>20241002_SovereignLimitsDB_Q3_2024_Apple/GIS/S...</td>
<td>[Id, IMPEC1, IMPEC2, UID, Region, Label, State...</td>
</tr>
<tr>
<th>31</th>
<td>Land_Boundaries</td>
<td>MultiLineString</td>
<td>9881</td>
<td>20241203_SovereignLimitsDB_Q4_2024_Apple/GIS/S...</td>
<td>[Id, IMPEC1, IMPEC2, UID, Region, Label, State...</td>
</tr>
<tr>
<th>22</th>
<td>Maritime_Boundaries</td>
<td>MultiLineString</td>
<td>339</td>
<td>20241002_SovereignLimitsDB_Q3_2024_Apple/GIS/S...</td>
<td>[IMPEC1, IMPEC2, UID, Region, Label, State1, S...</td>
</tr>
<tr>
<th>32</th>
<td>Maritime_Boundaries</td>
<td>MultiLineString</td>
<td>339</td>
<td>20241203_SovereignLimitsDB_Q4_2024_Apple/GIS/S...</td>
<td>[IMPEC1, IMPEC2, UID, Region, Label, State1, S...</td>
</tr>
<tr>
<th>8</th>
<td>Provisional_Equidistance</td>
<td>MultiLineString</td>
<td>283</td>
<td>20241002_SovereignLimitsDB_Q3_2024_Apple/GIS/S...</td>
<td>[IMPEC1, IMPEC2, UID, Notes, Region, State1, S...</td>
</tr>
<tr>
<th>33</th>
<td>Provisional_Equidistance</td>
<td>MultiLineString</td>
<td>283</td>
<td>20241203_SovereignLimitsDB_Q4_2024_Apple/GIS/S...</td>
<td>[IMPEC1, IMPEC2, UID, Notes, Region, State1, S...</td>
</tr>
<tr>
<th>9</th>
<td>Shared_Sovereignty_Areas</td>
<td>MultiPolygon</td>
<td>5</td>
<td>20241002_SovereignLimitsDB_Q3_2024_Apple/GIS/S...</td>
<td>[IMPEC1, IMPEC2, IMPEC3, UID, State1, State2, ...</td>
</tr>
<tr>
<th>34</th>
<td>Shared_Sovereignty_Areas</td>
<td>MultiPolygon</td>
<td>5</td>
<td>20241203_SovereignLimitsDB_Q4_2024_Apple/GIS/S...</td>
<td>[IMPEC1, IMPEC2, IMPEC3, UID, State1, State2, ...</td>
</tr>
<tr>
<th>10</th>
<td>Shared_Sovereignty_Zones</td>
<td>MultiPolygon</td>
<td>6</td>
<td>20241002_SovereignLimitsDB_Q3_2024_Apple/GIS/S...</td>
<td>[IMPEC1, IMPEC2, IMPEC3, UID, State1, State2, ...</td>
</tr>
<tr>
<th>35</th>
<td>Shared_Sovereignty_Zones</td>
<td>MultiPolygon</td>
<td>6</td>
<td>20241203_SovereignLimitsDB_Q4_2024_Apple/GIS/S...</td>
<td>[IMPEC1, IMPEC2, IMPEC3, UID, State1, State2, ...</td>
</tr>
<tr>
<th>19</th>
<td>Sovereignty_Areas</td>
<td>MultiPolygon</td>
<td>285</td>
<td>20241002_SovereignLimitsDB_Q3_2024_Apple/GIS/S...</td>
<td>[UID, IMPEC, State, ISO_A3, ISO_A2, Notes, Sha...</td>
</tr>
<tr>
<th>44</th>
<td>Sovereignty_Areas</td>
<td>MultiPolygon</td>
<td>359</td>
<td>20241203_SovereignLimitsDB_Q4_2024_Apple/GIS/S...</td>
<td>[UID, IMPEC, State, ISO_A3, ISO_A2, Notes, Sha...</td>
</tr>
<tr>
<th>11</th>
<td>Straight_Baselines</td>
<td>MultiLineString</td>
<td>151</td>
<td>20241002_SovereignLimitsDB_Q3_2024_Apple/GIS/S...</td>
<td>[IMPEC, UID, Notes, Source, Region, State, por...</td>
</tr>
<tr>
<th>36</th>
<td>Straight_Baselines</td>
<td>MultiLineString</td>
<td>151</td>
<td>20241203_SovereignLimitsDB_Q4_2024_Apple/GIS/S...</td>
<td>[IMPEC, UID, Notes, Source, Region, State, por...</td>
</tr>
<tr>
<th>12</th>
<td>Territorial_Sea_Limits</td>
<td>MultiLineString</td>
<td>353</td>
<td>20241002_SovereignLimitsDB_Q3_2024_Apple/GIS/S...</td>
<td>[IMPEC, UID, Notes, Region, State, portalURL, ...</td>
</tr>
<tr>
<th>37</th>
<td>Territorial_Sea_Limits</td>
<td>MultiLineString</td>
<td>353</td>
<td>20241203_SovereignLimitsDB_Q4_2024_Apple/GIS/S...</td>
<td>[IMPEC, UID, Notes, Region, State, portalURL, ...</td>
</tr>
<tr>
<th>13</th>
<td>Undetermined_Sovereignty_Areas</td>
<td>MultiPolygon</td>
<td>6</td>
<td>20241002_SovereignLimitsDB_Q3_2024_Apple/GIS/S...</td>
<td>[UID, IMPEC1, IMPEC2, State1, State2, Label, R...</td>
</tr>
<tr>
<th>38</th>
<td>Undetermined_Sovereignty_Areas</td>
<td>MultiPolygon</td>
<td>6</td>
<td>20241203_SovereignLimitsDB_Q4_2024_Apple/GIS/S...</td>
<td>[UID, IMPEC1, IMPEC2, State1, State2, Label, R...</td>
</tr>
<tr>
<th>14</th>
<td>Undetermined_Sovereignty_Zones</td>
<td>MultiPolygon</td>
<td>1</td>
<td>20241002_SovereignLimitsDB_Q3_2024_Apple/GIS/S...</td>
<td>[UID, IMPEC1, IMPEC2, State1, State2, Label, R...</td>
</tr>
<tr>
<th>39</th>
<td>Undetermined_Sovereignty_Zones</td>
<td>MultiPolygon</td>
<td>1</td>
<td>20241203_SovereignLimitsDB_Q4_2024_Apple/GIS/S...</td>
<td>[UID, IMPEC1, IMPEC2, State1, State2, Label, R...</td>
</tr>
</tbody>
</table>
</div>
<div class="highlight"><pre><span></span><code>...Saving file: info.csv
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># Get count of MultiPolygon layers by layer name.</span>
<span class="n">info_df</span> <span class="o">=</span> <span class="n">info_df</span><span class="p">[</span><span class="n">info_df</span><span class="p">[</span><span class="s2">"geometry_type"</span><span class="p">]</span> <span class="o">==</span> <span class="s2">"MultiPolygon"</span><span class="p">]</span>
<span class="n">info_df</span><span class="p">[</span><span class="s2">"layer_name"</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="nx">layer_name</span>
<span class="nx">COMBINED_Disputed_Sovereignty_Areas_Disputed_Exclusive_Economic_Zones</span><span class="w">    </span><span class="mi">2</span>
<span class="nx">COMBINED_Sovereignty_Areas_Exclusive_Economic_Zones</span><span class="w">                      </span><span class="mi">2</span>
<span class="nx">Disputed_Exclusive_Economic_Zones</span><span class="w">                                        </span><span class="mi">2</span>
<span class="nx">Disputed_Sovereignty_Areas</span><span class="w">                                               </span><span class="mi">2</span>
<span class="nx">Disputed_Sovereignty_Areas_with_Administrative_Units</span><span class="w">                     </span><span class="mi">2</span>
<span class="nx">Exclusive_Economic_Zones</span><span class="w">                                                 </span><span class="mi">2</span>
<span class="nx">Extended_Continental_Shelf_Submissions_Polygons</span><span class="w">                          </span><span class="mi">2</span>
<span class="nx">Shared_Sovereignty_Areas</span><span class="w">                                                 </span><span class="mi">2</span>
<span class="nx">Shared_Sovereignty_Zones</span><span class="w">                                                 </span><span class="mi">2</span>
<span class="nx">Sovereignty_Areas</span><span class="w">                                                        </span><span class="mi">2</span>
<span class="nx">Undetermined_Sovereignty_Areas</span><span class="w">                                           </span><span class="mi">2</span>
<span class="nx">Undetermined_Sovereignty_Zones</span><span class="w">                                           </span><span class="mi">2</span>
<span class="nx">Name</span><span class="p">:</span><span class="w"> </span><span class="nx">count</span><span class="p">,</span><span class="w"> </span><span class="nx">dtype</span><span class="p">:</span><span class="w"> </span><span class="nx">int64</span>
</code></pre></div>
<h1 id="load-the-layer-to-compare">Load the layer to compare</h1>
<div class="highlight"><pre><span></span><code><span class="n">layers</span> <span class="o">=</span> <span class="n">LAYERS</span>

<span class="n">layer_dict</span> <span class="o">=</span> <span class="p">{}</span>    
<span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">layers</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">files</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="n">l</span><span class="p">)</span>
        <span class="n">col_names</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="p">:</span> <span class="n">standardize_col</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">gdf</span><span class="o">.</span><span class="n">columns</span><span class="p">}</span>
        <span class="n">gdf</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">col_names</span><span class="p">)</span>
        <span class="n">layer_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># Display the contents of the layers which have been loaded.</span>

<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">layer_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"...file:"</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">files</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>...file: f1 20241002_SovereignLimitsDB_Q3_2024_Apple/GIS/SovereignLimitsDB_Q3_2024.gdb
</code></pre></div>
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe my-data-table">
<thead>
<tr style="text-align: right;">
<th></th>
<th>uid</th>
<th>impec</th>
<th>state</th>
<th>iso_a3</th>
<th>iso_a2</th>
<th>notes</th>
<th>shape_length</th>
<th>shape_area</th>
<th>geometry</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>sov-AFGAFG-p001</td>
<td>AFGAFG</td>
<td>Afghanistan</td>
<td>AFG</td>
<td>AF</td>
<td>None</td>
<td>62.077819</td>
<td>62.553088</td>
<td>MULTIPOLYGON (((70.98885 38.49097, 70.98896 38...</td>
</tr>
<tr>
<th>1</th>
<td>sov-AGOAGO-p001</td>
<td>AGOAGO</td>
<td>Angola</td>
<td>AGO</td>
<td>AO</td>
<td>None</td>
<td>62.843752</td>
<td>106.016056</td>
<td>MULTIPOLYGON (((14.00067 -5.82611, 14.00075 -5...</td>
</tr>
<tr>
<th>2</th>
<td>sov-AGOCBD-p001</td>
<td>AGOCBD</td>
<td>Angola (Cabinda)</td>
<td>AGO</td>
<td>AO</td>
<td>None</td>
<td>6.025314</td>
<td>0.737915</td>
<td>MULTIPOLYGON (((12.76687 -4.3879, 12.7669 -4.3...</td>
</tr>
<tr>
<th>3</th>
<td>sov-ALBALB-p001</td>
<td>ALBALB</td>
<td>Albania</td>
<td>ALB</td>
<td>AL</td>
<td>None</td>
<td>10.816154</td>
<td>3.743040</td>
<td>MULTIPOLYGON (((19.72731 42.66056, 19.72753 42...</td>
</tr>
<tr>
<th>4</th>
<td>sov-ANDAND-p001</td>
<td>ANDAND</td>
<td>Andorra</td>
<td>AND</td>
<td>AD</td>
<td>None</td>
<td>1.331073</td>
<td>0.051031</td>
<td>MULTIPOLYGON (((1.54928 42.65586, 1.54957 42.6...</td>
</tr>
</tbody>
</table>
</div>
<div class="highlight"><pre><span></span><code>...file: f2 20241203_SovereignLimitsDB_Q4_2024_Apple/GIS/SovereignLimitsDB_Q4_2024.gdb
</code></pre></div>
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe my-data-table">
<thead>
<tr style="text-align: right;">
<th></th>
<th>uid</th>
<th>impec</th>
<th>state</th>
<th>iso_a3</th>
<th>iso_a2</th>
<th>notes</th>
<th>shape_length</th>
<th>shape_area</th>
<th>geometry</th>
</tr>
</thead>
<tbody>
<tr>
<th>0</th>
<td>sov-AFGAFG-p001</td>
<td>AFGAFG</td>
<td>Afghanistan</td>
<td>AFG</td>
<td>AF</td>
<td>None</td>
<td>62.077819</td>
<td>62.553088</td>
<td>MULTIPOLYGON (((70.98885 38.49097, 70.98896 38...</td>
</tr>
<tr>
<th>1</th>
<td>sov-AGOAGO-p001</td>
<td>AGOAGO</td>
<td>Angola</td>
<td>AGO</td>
<td>AO</td>
<td>None</td>
<td>62.843752</td>
<td>106.016056</td>
<td>MULTIPOLYGON (((14.00067 -5.82611, 14.00075 -5...</td>
</tr>
<tr>
<th>2</th>
<td>sov-AGOCBD-p001</td>
<td>AGOCBD</td>
<td>Angola (Cabinda)</td>
<td>AGO</td>
<td>AO</td>
<td>None</td>
<td>6.025314</td>
<td>0.737915</td>
<td>MULTIPOLYGON (((12.76687 -4.3879, 12.7669 -4.3...</td>
</tr>
<tr>
<th>3</th>
<td>sov-ALBALB-p001</td>
<td>ALBALB</td>
<td>Albania</td>
<td>ALB</td>
<td>AL</td>
<td>None</td>
<td>10.816154</td>
<td>3.743040</td>
<td>MULTIPOLYGON (((19.72731 42.66056, 19.72753 42...</td>
</tr>
<tr>
<th>4</th>
<td>sov-ANDAND-p001</td>
<td>ANDAND</td>
<td>Andorra</td>
<td>AND</td>
<td>AD</td>
<td>None</td>
<td>1.331073</td>
<td>0.051031</td>
<td>MULTIPOLYGON (((1.54928 42.65586, 1.54957 42.6...</td>
</tr>
</tbody>
</table>
</div>
<h1 id="dissolve-into-a-single-multi-polygon-per-country">Dissolve into a single (multi-)polygon per country</h1>
<div class="highlight"><pre><span></span><code><span class="c1"># TODO: For dissimilar datasets we need to check the name of the field to dissolve by for each dataset.</span>
<span class="c1"># ISO3 might be a better choice.</span>

<span class="n">dissolved_dict</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">layer_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"...file:"</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">files</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">DISSOLVED_COLUMNS</span><span class="p">]</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s2">"None"</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">dissolve</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="n">DISSOLVE_BY</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
    <span class="n">dissolved_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>...file: f1 20241002_SovereignLimitsDB_Q3_2024_Apple/GIS/SovereignLimitsDB_Q3_2024.gdb
</code></pre></div>
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe my-data-table">
<thead>
<tr style="text-align: right;">
<th></th>
<th>geometry</th>
<th>state</th>
<th>iso_a3</th>
</tr>
<tr>
<th>uid</th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<th>sov-AFGAFG-p001</th>
<td>POLYGON ((70.98885 38.49097, 70.98896 38.49096...</td>
<td>Afghanistan</td>
<td>AFG</td>
</tr>
<tr>
<th>sov-AGOAGO-p001</th>
<td>POLYGON ((14.00067 -5.82611, 14.00075 -5.82611...</td>
<td>Angola</td>
<td>AGO</td>
</tr>
<tr>
<th>sov-AGOCBD-p001</th>
<td>POLYGON ((12.76687 -4.3879, 12.7669 -4.3879, 1...</td>
<td>Angola (Cabinda)</td>
<td>AGO</td>
</tr>
<tr>
<th>sov-ALBALB-p001</th>
<td>POLYGON ((19.72731 42.66056, 19.72753 42.66019...</td>
<td>Albania</td>
<td>ALB</td>
</tr>
<tr>
<th>sov-ANDAND-p001</th>
<td>POLYGON ((1.54928 42.65586, 1.54957 42.65553, ...</td>
<td>Andorra</td>
<td>AND</td>
</tr>
<tr>
<th>...</th>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr>
<th>sov-YEMYEM-p001</th>
<td>MULTIPOLYGON (((41.82746 15.32248, 41.82729 15...</td>
<td>Yemen</td>
<td>YEM</td>
</tr>
<tr>
<th>sov-ZAFPEI-p001</th>
<td>POLYGON ((37.90894 -46.39955, 37.90909 -46.399...</td>
<td>South Africa (Prince Edward Islands)</td>
<td>ZAF</td>
</tr>
<tr>
<th>sov-ZAFZAF-p001</th>
<td>POLYGON ((29.65699 -22.12476, 29.65722 -22.124...</td>
<td>South Africa</td>
<td>ZAF</td>
</tr>
<tr>
<th>sov-ZMBZMB-p001</th>
<td>POLYGON ((30.79463 -8.26659, 30.80439 -8.28884...</td>
<td>Zambia</td>
<td>ZMB</td>
</tr>
<tr>
<th>sov-ZWEZWE-p001</th>
<td>POLYGON ((29.82795 -15.60966, 29.82816 -15.609...</td>
<td>Zimbabwe</td>
<td>ZWE</td>
</tr>
</tbody>
</table>
<p>277 rows Ã 3 columns</p>
</div>
<div class="highlight"><pre><span></span><code>...file: f2 20241203_SovereignLimitsDB_Q4_2024_Apple/GIS/SovereignLimitsDB_Q4_2024.gdb
</code></pre></div>
<h1 id="find-any-changes-in-number-of-multipolygon-parts-per-country">Find any changes in number of multipolygon parts per country</h1>
<div class="highlight"><pre><span></span><code><span class="c1"># Get count of multipolygon parts per state.</span>

<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dissolved_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"...file:"</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">files</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
    <span class="n">display</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># Create a subdirectory to hold results.</span>

<span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">LAYERS</span><span class="p">:</span>
    <span class="n">s1</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">f1</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span>
    <span class="n">s2</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">f2</span><span class="p">)</span><span class="o">.</span><span class="n">stem</span>
    <span class="n">subdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">"."</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">s1</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">subdir</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">subdir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># Report changes in number of parts of multipolygon features by county -- i.e. the DISSOLVE_BY key(s).</span>

<span class="n">gdf1</span> <span class="o">=</span> <span class="n">dissolved_dict</span><span class="p">[</span><span class="s2">"f1"</span><span class="p">]</span>
<span class="n">gdf2</span> <span class="o">=</span> <span class="n">dissolved_dict</span><span class="p">[</span><span class="s2">"f2"</span><span class="p">]</span>

<span class="n">merged</span> <span class="o">=</span> <span class="n">gdf1</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">gdf2</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">"outer"</span><span class="p">,</span> <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">suffixes</span><span class="o">=</span><span class="p">[</span><span class="s2">"_f1"</span><span class="p">,</span> <span class="s2">"_f2"</span><span class="p">])</span>
<span class="n">merged</span><span class="p">[</span><span class="s2">"nparts_f1"</span><span class="p">]</span> <span class="o">=</span> <span class="n">merged</span><span class="p">[</span><span class="s2">"geometry_f1"</span><span class="p">]</span><span class="o">.</span><span class="n">count_geometries</span><span class="p">()</span>
<span class="n">merged</span><span class="p">[</span><span class="s2">"nparts_f2"</span><span class="p">]</span> <span class="o">=</span> <span class="n">merged</span><span class="p">[</span><span class="s2">"geometry_f2"</span><span class="p">]</span><span class="o">.</span><span class="n">count_geometries</span><span class="p">()</span>

<span class="c1"># Drop geometry columns.</span>
<span class="n">keep_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">merged</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">merged</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="s2">"geometry"</span><span class="p">]</span>

<span class="n">res</span> <span class="o">=</span> <span class="n">merged</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">keep_columns</span><span class="p">]</span>
<span class="c1"># Only include states where number has changed.</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">res</span><span class="p">[</span><span class="n">res</span><span class="p">[</span><span class="s2">"nparts_f1"</span><span class="p">]</span> <span class="o">!=</span> <span class="n">res</span><span class="p">[</span><span class="s2">"nparts_f2"</span><span class="p">]]</span>
<span class="n">count</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">fn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"delta_nparts_</span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2">.csv"</span>
<span class="n">fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subdir</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"...Saving file:"</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
<span class="n">res</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">res</span>
</code></pre></div>
<h1 id="find-changes-in-geometry">Find changes in geometry</h1>
<div class="highlight"><pre><span></span><code><span class="c1"># Find countries that have geometry changes.</span>
<span class="c1"># This uses the geom_equals method to compare geometries from both data sets.</span>
<span class="c1"># TODO: for dissimilar datasets it will be more complex to match polygons from each dataset.</span>

<span class="n">gdf1</span> <span class="o">=</span> <span class="n">dissolved_dict</span><span class="p">[</span><span class="s2">"f1"</span><span class="p">]</span>
<span class="n">gdf2</span> <span class="o">=</span> <span class="n">dissolved_dict</span><span class="p">[</span><span class="s2">"f2"</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"...gdf1: </span><span class="si">{</span><span class="n">gdf1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">, gdf2: </span><span class="si">{</span><span class="n">gdf2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="c1"># delta = pd.merge(gdf1, gdf2, on=DISSOLVED_COLUMNS, how='outer', suffixes=["_f1", "_f2"])</span>
<span class="c1"># print("...merged:", delta.shape[0])</span>

<span class="n">delta</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">gdf1</span><span class="p">,</span> <span class="n">gdf2</span><span class="p">,</span> <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">'outer'</span><span class="p">,</span> <span class="n">suffixes</span><span class="o">=</span><span class="p">[</span><span class="s2">"_f1"</span><span class="p">,</span> <span class="s2">"_f2"</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"...merged:"</span><span class="p">,</span> <span class="n">delta</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="n">g1</span> <span class="o">=</span> <span class="n">delta</span><span class="p">[</span><span class="s2">"geometry_f1"</span><span class="p">]</span>
<span class="n">g2</span> <span class="o">=</span> <span class="n">delta</span><span class="p">[</span><span class="s2">"geometry_f2"</span><span class="p">]</span>

<span class="n">e</span> <span class="o">=</span> <span class="n">g1</span><span class="o">.</span><span class="n">geom_equals</span><span class="p">(</span><span class="n">g2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"...geom equal:"</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="n">e</span><span class="p">]))</span>
<span class="n">delta</span> <span class="o">=</span> <span class="n">delta</span><span class="p">[</span><span class="o">~</span><span class="n">e</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"...geom not equal:"</span><span class="p">,</span> <span class="n">delta</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="c1"># if "iso_a3_f2" in delta.columns:</span>
<span class="c1">#     delta = delta.drop(["iso_a3_f2"], axis=1)</span>

<span class="n">delta</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
<h1 id="symmetric-difference">Symmetric difference</h1>
<div class="highlight"><pre><span></span><code><span class="c1"># Find the symmetric differences.</span>

<span class="n">g1</span> <span class="o">=</span> <span class="n">delta</span><span class="p">[</span><span class="s2">"geometry_f1"</span><span class="p">]</span>
<span class="n">g2</span> <span class="o">=</span> <span class="n">delta</span><span class="p">[</span><span class="s2">"geometry_f2"</span><span class="p">]</span>
<span class="n">delta</span><span class="p">[</span><span class="s2">"sdiff"</span><span class="p">]</span> <span class="o">=</span> <span class="n">g1</span><span class="o">.</span><span class="n">symmetric_difference</span><span class="p">(</span><span class="n">g2</span><span class="p">)</span>

<span class="n">delta</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># Explode mulipart polygons, get area and perimeter for symmetric differences, and add lat/lon.</span>

<span class="n">sd</span> <span class="o">=</span> <span class="n">delta</span><span class="o">.</span><span class="n">set_geometry</span><span class="p">(</span><span class="s2">"sdiff"</span><span class="p">)</span>
<span class="n">sd</span> <span class="o">=</span> <span class="n">sd</span><span class="o">.</span><span class="n">explode</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sd</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sd</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">value_counts</span><span class="p">())</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">get_area_perim</span><span class="p">(</span><span class="n">sd</span><span class="p">)</span>
<span class="n">sd</span><span class="p">[</span><span class="s2">"sdiff_area"</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<span class="n">sd</span><span class="p">[</span><span class="s2">"sdiff_perimeter"</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">rp</span> <span class="o">=</span> <span class="n">sd</span><span class="p">[</span><span class="s2">"sdiff"</span><span class="p">]</span><span class="o">.</span><span class="n">representative_point</span><span class="p">()</span>
<span class="n">sd</span><span class="p">[</span><span class="s2">"lat"</span><span class="p">]</span> <span class="o">=</span> <span class="n">rp</span><span class="o">.</span><span class="n">y</span>
<span class="n">sd</span><span class="p">[</span><span class="s2">"lon"</span><span class="p">]</span> <span class="o">=</span> <span class="n">rp</span><span class="o">.</span><span class="n">x</span>

<span class="c1"># TODO: create function to pick geom column and save geopackage.</span>
<span class="c1"># count = sd.shape[0]</span>
<span class="c1"># fn = f"sdiff_{count}.csv"</span>
<span class="c1"># fn = os.path.join(subdir, fn)</span>
<span class="c1"># print("...Saving file:", fn)</span>
<span class="c1"># sd = sd.set_geometry("sdiff")</span>
<span class="c1"># sd.to_file(fn, driver="GPKG")</span>

<span class="n">sd</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</code></pre></div>
<h1 id="filter-out-slivers">Filter out slivers</h1>
<h3 id="filter-out-small-sdiff-areas">Filter out small sdiff areas</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Exclude differences with an area below the MIN_AREA_THRESHOLD if it is defined.</span>

<span class="n">area</span> <span class="o">=</span> <span class="n">sd</span><span class="p">[:]</span>
<span class="n">area_threshold</span> <span class="o">=</span> <span class="n">MIN_AREA_THRESHOLD</span>

<span class="c1"># Eliminate large values and plot histogram in vecinity of threshold.</span>
<span class="n">hist</span> <span class="o">=</span> <span class="n">area</span><span class="p">[</span><span class="n">area</span><span class="p">[</span><span class="s2">"sdiff_area"</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">500</span><span class="p">]</span>
<span class="n">hist</span><span class="p">[</span><span class="s2">"sdiff_area"</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

<span class="k">if</span> <span class="n">area_threshold</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s2">"area"</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">()</span> <span class="ow">and</span> <span class="n">area</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"...Applying minimum area threshold of </span><span class="si">{</span><span class="n">area_threshold</span><span class="si">}</span><span class="s2"> square meters."</span><span class="p">)</span>

    <span class="n">area</span> <span class="o">=</span> <span class="n">area</span><span class="p">[</span><span class="n">area</span><span class="p">[</span><span class="s2">"sdiff_area"</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">area_threshold</span><span class="p">]</span>
    <span class="n">area</span> <span class="o">=</span> <span class="n">area</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">"sdiff_area"</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"...Symetric difference areas above area thereshold: </span><span class="si">{</span><span class="n">area</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">area</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</code></pre></div>
<h3 id="filter-out-areas-with-low-isoperimetric-quotient">Filter out areas with low isoperimetric quotient</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Exclude differences with an isoperimetric quotient below the MIN_IQ_THRESHOLD if it is defined.</span>

<span class="n">iq</span> <span class="o">=</span> <span class="n">area</span><span class="p">[:]</span>
<span class="n">iq_threshold</span> <span class="o">=</span> <span class="n">MIN_IQ_THRESHOLD</span>

<span class="c1"># Calculate iq and add to DataFrame as new column.</span>
<span class="n">iq</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s2">"iq"</span><span class="p">]]</span>  <span class="o">=</span> <span class="n">iq</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">calculate_iq</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">"sdiff_area"</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">"sdiff_perimeter"</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Eliminate large values and plot histogram in vecinity of threshold.</span>
<span class="n">hist</span> <span class="o">=</span> <span class="n">iq</span><span class="p">[</span><span class="n">iq</span><span class="p">[</span><span class="s2">"iq"</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.25</span><span class="p">]</span>
<span class="n">hist</span><span class="p">[</span><span class="s2">"iq"</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

<span class="k">if</span> <span class="n">iq_threshold</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">iq</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"...Applying minimum iq threshold of </span><span class="si">{</span><span class="n">iq_threshold</span><span class="si">}</span><span class="s2">."</span><span class="p">)</span>

    <span class="n">iq</span> <span class="o">=</span> <span class="n">iq</span><span class="p">[</span><span class="n">iq</span><span class="p">[</span><span class="s2">"iq"</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">iq_threshold</span><span class="p">]</span>
    <span class="n">iq</span> <span class="o">=</span> <span class="n">iq</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">"iq"</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"...Symetric difference areas above iq thereshold: </span><span class="si">{</span><span class="n">iq</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">iq</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># Sort the results by DISSOLVE_BY key and area.</span>

<span class="n">res</span> <span class="o">=</span> <span class="n">iq</span><span class="p">[:]</span>
<span class="k">if</span> <span class="n">res</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>

    <span class="c1"># # TODO: substitute correct column names for state here. Can we mix (multi)index and columns in sort?</span>

    <span class="c1"># res = res.sort_values(by=["state_f1", "state_f2", "sdiff_area", "iq"], ascending=[True, True, True, False, False])</span>
    <span class="c1"># res = res.reset_index()</span>
    <span class="c1"># # sd["idx"] = sd.index # TODO: what was this for???</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</code></pre></div>
<h1 id="get-top-n-differences-by-area-per-state">Get top N differences by area per state</h1>
<div class="highlight"><pre><span></span><code><span class="c1"># Select top n area changes for each DISSOLVE_BY key.</span>

<span class="n">n</span> <span class="o">=</span> <span class="n">N</span>
<span class="k">if</span> <span class="s2">"res"</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">()</span> <span class="ow">and</span> <span class="n">res</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>

    <span class="c1"># TODO: fix "state" here </span>

    <span class="n">idx1</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">DISSOLVE_BY</span><span class="p">)[</span><span class="s2">"sdiff_area"</span><span class="p">]</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">topn</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx1</span><span class="p">,</span> <span class="p">:]</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"...top</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">topn</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">topn</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>...top10: 69563
</code></pre></div>
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe my-data-table">
<thead>
<tr style="text-align: right;">
<th></th>
<th>geometry_f1</th>
<th>state_f1</th>
<th>iso_a3_f1</th>
<th>geometry_f2</th>
<th>state_f2</th>
<th>iso_a3_f2</th>
<th>sdiff</th>
<th>sdiff_area</th>
<th>sdiff_perimeter</th>
<th>lat</th>
<th>lon</th>
<th>iq</th>
</tr>
<tr>
<th>uid</th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<th>sov-ARGARG-p001</th>
<td>MULTIPOLYGON (((-66.19412 -21.796, -66.17402 -...</td>
<td>Argentina</td>
<td>ARG</td>
<td>MULTIPOLYGON (((-66.0763 -21.83495, -66.05981 ...</td>
<td>Argentina</td>
<td>ARG</td>
<td>POLYGON ((-60.96215 -23.81654, -60.96131 -23.8...</td>
<td>224344.685053</td>
<td>1830.934237</td>
<td>-23.818121</td>
<td>-60.959757</td>
<td>0.840969</td>
</tr>
<tr>
<th>sov-ARGARG-p001</th>
<td>MULTIPOLYGON (((-66.19412 -21.796, -66.17402 -...</td>
<td>Argentina</td>
<td>ARG</td>
<td>MULTIPOLYGON (((-66.0763 -21.83495, -66.05981 ...</td>
<td>Argentina</td>
<td>ARG</td>
<td>POLYGON ((-62.55041 -22.33186, -62.55235 -22.3...</td>
<td>694961.683186</td>
<td>3241.456565</td>
<td>-22.332462</td>
<td>-62.555831</td>
<td>0.831171</td>
</tr>
<tr>
<th>sov-ARGARG-p001</th>
<td>MULTIPOLYGON (((-66.19412 -21.796, -66.17402 -...</td>
<td>Argentina</td>
<td>ARG</td>
<td>MULTIPOLYGON (((-66.0763 -21.83495, -66.05981 ...</td>
<td>Argentina</td>
<td>ARG</td>
<td>POLYGON ((-60.95294 -23.81168, -60.95188 -23.8...</td>
<td>259442.915810</td>
<td>2014.899345</td>
<td>-23.813459</td>
<td>-60.953100</td>
<td>0.803054</td>
</tr>
<tr>
<th>sov-ARGARG-p001</th>
<td>MULTIPOLYGON (((-66.19412 -21.796, -66.17402 -...</td>
<td>Argentina</td>
<td>ARG</td>
<td>MULTIPOLYGON (((-66.0763 -21.83495, -66.05981 ...</td>
<td>Argentina</td>
<td>ARG</td>
<td>POLYGON ((-62.36913 -22.46026, -62.36913 -22.4...</td>
<td>23476.526346</td>
<td>613.533206</td>
<td>-22.460912</td>
<td>-62.369793</td>
<td>0.783732</td>
</tr>
<tr>
<th>sov-ARGARG-p001</th>
<td>MULTIPOLYGON (((-66.19412 -21.796, -66.17402 -...</td>
<td>Argentina</td>
<td>ARG</td>
<td>MULTIPOLYGON (((-66.0763 -21.83495, -66.05981 ...</td>
<td>Argentina</td>
<td>ARG</td>
<td>POLYGON ((-61.09231 -23.62054, -61.09431 -23.6...</td>
<td>189951.051916</td>
<td>1779.038861</td>
<td>-23.619303</td>
<td>-61.094234</td>
<td>0.754190</td>
</tr>
</tbody>
</table>
</div>
<h1 id="save-results-as-geopackage">Save results as geopackage</h1>
<div class="highlight"><pre><span></span><code><span class="c1"># Save results as a geopackage.</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">N</span>

<span class="k">if</span> <span class="s2">"topn"</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">()</span> <span class="ow">and</span> <span class="n">topn</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">count</span> <span class="o">=</span> <span class="n">topn</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Save csv file without geometry.</span>
    <span class="n">selected_cols</span> <span class="o">=</span> <span class="n">OUTPUT_COLUMNS</span><span class="p">[:]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">topn</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">selected_cols</span><span class="p">]</span>
    <span class="n">fn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"top</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2">.csv"</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"...Saving file:"</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
    <span class="n">fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subdir</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># # Save geopackage files -- one per geometry column or as csv without geometry col.</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">GEOMETRY_COLUMNS</span><span class="p">:</span>
        <span class="n">selected_cols</span> <span class="o">=</span> <span class="n">OUTPUT_COLUMNS</span><span class="p">[:]</span>
        <span class="n">selected_cols</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">c</span><span class="p">])</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">topn</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">selected_cols</span><span class="p">]</span>
        <span class="n">fn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"top</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2">.gpkg"</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"...Saving file:"</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
        <span class="n">fn</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subdir</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="s2">"GPKG"</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code>...Saving file: top10_69563.csv
...Saving file: top10_sdiff_69563.gpkg
</code></pre></div>
<h1 id="visualize-results">Visualize results</h1>
<div class="highlight"><pre><span></span><code><span class="c1"># All changes on one map.</span>

<span class="k">if</span> <span class="s2">"topn"</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">()</span> <span class="ow">and</span> <span class="n">topn</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">topn</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">"sdiff_area"</span><span class="p">,</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">10</span><span class="p">,:]</span>  <span class="c1"># Only display top 100 differences otherwise it's too slow.</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">set_geometry</span><span class="p">(</span><span class="s2">"geometry_f2"</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">explore</span><span class="p">(</span><span class="n">style_kwds</span><span class="o">=</span><span class="p">{</span><span class="s2">"fill"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">"fillColor"</span><span class="p">:</span> <span class="s2">"green"</span><span class="p">,</span> <span class="s2">"fillOpacity"</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s2">"stroke"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">"color"</span><span class="p">:</span> <span class="s2">"green"</span><span class="p">,</span> <span class="s2">"weight"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"opacity"</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">},</span> <span class="n">name</span><span class="o">=</span><span class="s2">"geometry_f2"</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">set_geometry</span><span class="p">(</span><span class="s2">"geometry_f1"</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">explore</span><span class="p">(</span><span class="n">m</span><span class="o">=</span><span class="n">m</span><span class="p">,</span> <span class="n">style_kwds</span><span class="o">=</span><span class="p">{</span><span class="s2">"fill"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">"fillColor"</span><span class="p">:</span> <span class="s2">"blue"</span><span class="p">,</span> <span class="s2">"fillOpacity"</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s2">"stroke"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">"color"</span><span class="p">:</span> <span class="s2">"blue"</span><span class="p">,</span> <span class="s2">"weight"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">"opacity"</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">},</span> <span class="n">name</span><span class="o">=</span><span class="s2">"geometry_f1"</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">set_geometry</span><span class="p">(</span><span class="s2">"sdiff"</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">explore</span><span class="p">(</span><span class="n">m</span><span class="o">=</span><span class="n">m</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">"red"</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"sdiff"</span><span class="p">)</span>
    <span class="n">folium</span><span class="o">.</span><span class="n">LayerControl</span><span class="p">()</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
    <span class="n">display</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># One map for each change.</span>

<span class="k">if</span> <span class="s2">"topn"</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">()</span> <span class="ow">and</span> <span class="n">topn</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">topn</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">'state'</span><span class="p">]</span><span class="si">}</span><span class="s2">: lat/lon = (</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">'lat'</span><span class="p">]</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">'lon'</span><span class="p">]</span><span class="si">}</span><span class="s2">), area = </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">'sdiff_area'</span><span class="p">]</span><span class="o">/</span><span class="mi">10</span><span class="o">**</span><span class="mi">6</span><span class="si">}</span><span class="s2"> km sq."</span><span class="p">)</span>

        <span class="n">gdf</span> <span class="o">=</span> <span class="n">topn</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="n">index</span><span class="p">],</span> <span class="p">:]</span>

        <span class="n">gdf</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">set_geometry</span><span class="p">(</span><span class="s2">"sdiff"</span><span class="p">)</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">explore</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">"red"</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">"sdiff"</span><span class="p">)</span>

        <span class="c1"># TODO: output is too large if we include the whole country layers to show border changes.</span>
        <span class="c1"># Must clear cell output before saving notebook: </span>
        <span class="c1"># See: https://stackoverflow.com/questions/53402060/jupyter-notebook-malformed-http-message-from-1-content-length-too-long</span>

        <span class="c1"># gdf2 = gdf.set_geometry("geometry_f2")</span>
        <span class="c1"># m = gdf2.explore(m=m, style_kwds={"fill": True, "fillColor": "green", "fillOpacity": 0.1, "stroke": True, "color": "green", "weight": 1, "opacity": 0.2}, name="geometry_f2")</span>

        <span class="c1"># gdf1 = gdf.set_geometry("geometry_f1")</span>
        <span class="c1"># m = gdf1.explore(m=m, style_kwds={"fill": True, "fillColor": "blue", "fillOpacity": 0.1, "stroke": True, "color": "blue", "weight": 1, "opacity": 0.2}, name="geometry_f1")</span>

        <span class="n">folium</span><span class="o">.</span><span class="n">LayerControl</span><span class="p">()</span><span class="o">.</span><span class="n">add_to</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="n">display</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</code></pre></div></main>


             
 
            
            
            







            <hr/>
        </div>
        <section class="span2" id="article-sidebar">
            <h4>Published</h4>
            <time datetime="2025-07-06T00:00:00-07:00" itemprop="dateCreated">Sun 06 July 2025</time>

            <h4>Category</h4>
            <a class="category-link" href="./categories.html#notebooks-ref">Notebooks</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="./tags.html#geopandas-ref">GeoPandas
</a></li>
                <li><a href="./tags.html#jupyter-ref">Jupyter
                    <span class="superscript">1</span>
</a></li>
                <li><a href="./tags.html#python-ref">Python
                    <span class="superscript">5</span>
</a></li>
            </ul>
            





            





        </section>
</div>
</article>
<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div aria-hidden="true" class="pswp" role="dialog" tabindex="-1">

    <!-- Background of PhotoSwipe.
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides.
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo https://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>                    </div>
                    <div class="span1"></div>
                </div>
            </div>
        </div>
<footer>




    <div id="fpowered">
        Powered by: <a href="http://getpelican.com/" rel="nofollow noopener noreferrer" target="_blank" title="Pelican Home Page">Pelican</a>
        Theme: <a href="https://elegant.oncrashreboot.com/" rel="nofollow noopener noreferrer" target="_blank" title="Theme Elegant Home Page">Elegant</a>
    </div>
</footer>            <script src="//code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script src="./theme/js/elegant.prod.9e9d5ce754.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>
        <script src="./theme/js/jquery.colorbox.js"></script>
        <script src="./theme/js/load-colorbox.js"></script>
        <script src="https://files.stork-search.net/releases/v1.5.0/stork.js"></script>
        <script src="https://cdn.datatables.net/2.3.2/js/dataTables.js"></script>
        <script>
            stork.register("sitesearch", "./search-index.st");
        </script>
        <script>
            $(document).ready( function () {
                $('.my-data-table').DataTable();
            } );
        </script>

    <script>
    (function () {
        if (window.location.hash.match(/^#comment-\d+$/)) {
            $('#comment_thread').collapse('show');
        }
    })();
    window.onhashchange=function(){
        if (window.location.hash.match(/^#comment-\d+$/))
            window.location.reload(true);
    }
    $('#comment_thread').on('shown', function () {
        var link = document.getElementById('comment-accordion-toggle');
        var old_innerHTML = link.innerHTML;
        $(link).fadeOut(200, function() {
            $(this).text('Click here to hide comments').fadeIn(200);
        });
        $('#comment_thread').on('hidden', function () {
            $(link).fadeOut(200, function() {
                $(this).text(old_innerHTML).fadeIn(200);
            });
        })
    })
</script>

    </body>
    <!-- Theme: Elegant built for Pelican
        License : MIT -->
</html>